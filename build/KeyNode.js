"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var _a;
"use strict";
exports.ROOT_KEYS = Symbol('Root Keys Lib');
const CHILDREN = Symbol('Child Keys Lib');
const DEPTH = Symbol('Depth Cache');
const PARENTS = Symbol('Parents Cache');
class BaseKeyNode extends String {
    constructor(key, parent) {
        super(key);
        this[_a] = new Map();
        const keyLiteral = this.toString();
        const parentIsRootKeyLib = parent instanceof Map;
        const siblingLib = parentIsRootKeyLib ? parent : parent[CHILDREN];
        if (siblingLib.has(keyLiteral)) {
            throw new Error(`'${keyLiteral}' already exists in sibling set.` +
                `  Sibling key literals must be unique.`);
        }
        siblingLib.set(keyLiteral, this);
        if (parentIsRootKeyLib) {
            this[exports.ROOT_KEYS] = siblingLib;
            this.PARENT = null;
            this.IS_ROOT_KEY = true;
        }
        else {
            this.PARENT = parent;
            this.IS_ROOT_KEY = false;
        }
    }
    //Accessors 
    get isTerminalKey() {
        return this[CHILDREN].size === 0;
    }
    get [(_a = CHILDREN, Symbol.toStringTag)]() {
        return this.constructor.name;
    }
    get numChildren() {
        return this[CHILDREN].size;
    }
    get depth() {
        //Get and cache depth; lazy
        if (this[DEPTH] === undefined) {
            let depth = 0;
            for (const pKey of this.parents()) {
                depth++;
            }
            this[DEPTH] = depth;
        }
        return this[DEPTH];
    }
    //Mehtods
    hasChild(childKey) {
        return this[CHILDREN].has(childKey);
    }
    getChild(childKey) {
        const children = this[CHILDREN];
        return children.has(childKey) ? children.get(childKey) : null;
    }
    hasSibling(siblingKey) {
        const sliblingKeyLib = this.IS_ROOT_KEY ? this[exports.ROOT_KEYS] : this.PARENT[CHILDREN];
        return sliblingKeyLib.has(siblingKey) ?
            sliblingKeyLib.get(siblingKey) !== this : false;
    }
    getSibling(siblingKey) {
        if (this.hasSibling(siblingKey)) {
            const sliblingKeyLib = this.IS_ROOT_KEY ? this[exports.ROOT_KEYS] : this.PARENT[CHILDREN];
            return sliblingKeyLib.get(siblingKey);
        }
        ;
        return null;
    }
    children() {
        //NOTE: Not cached b/c can increase.
        return this[CHILDREN].values();
    }
    parents() {
        //Get and cache parents; lazy
        if (this[PARENTS] === undefined) {
            let pKeys = new Set();
            let pKey = this.PARENT;
            while (pKey !== null) {
                pKeys.add(pKey);
                pKey = pKey.PARENT;
            }
            this[PARENTS] = pKeys;
        }
        return this[PARENTS].values();
    }
    *siblings() {
        //NOTE: Not cached b/c can increase.
        const siblingsIter = this.IS_ROOT_KEY ? this[exports.ROOT_KEYS].values() : this.PARENT.children();
        for (const sib of siblingsIter) {
            if (sib !== this) {
                yield sib;
            }
        }
    }
}
exports.BaseKeyNode = BaseKeyNode;
class KeyNode extends BaseKeyNode {
}
exports.KeyNode = KeyNode;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiS2V5Tm9kZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9LZXlOb2RlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBYSxRQUFBLFNBQVMsR0FBaUIsTUFBTSxDQUFDLGVBQWUsQ0FBQyxDQUFDO0FBQy9ELE1BQU0sUUFBUSxHQUFpQixNQUFNLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztBQUN4RCxNQUFNLEtBQUssR0FBaUIsTUFBTSxDQUFDLGFBQWEsQ0FBQyxDQUFDO0FBQ2xELE1BQU0sT0FBTyxHQUFpQixNQUFNLENBQUMsZUFBZSxDQUFDLENBQUM7QUFFdEQsaUJBQW1FLFNBQVEsTUFBTTtJQVUvRSxZQUFZLEdBQVUsRUFBRSxNQUFpQztRQUV2RCxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7UUFOSSxRQUFVLEdBQUcsSUFBSSxHQUFHLEVBQWdCLENBQUM7UUFRcEQsTUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQ25DLE1BQU0sa0JBQWtCLEdBQUcsTUFBTSxZQUFZLEdBQUcsQ0FBQztRQUNqRCxNQUFNLFVBQVUsR0FBcUIsa0JBQWtCLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBRXBGLElBQUcsVUFBVSxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsRUFBQztZQUU1QixNQUFNLElBQUksS0FBSyxDQUFDLElBQUksVUFBVSxrQ0FBa0M7Z0JBQzlELHdDQUF3QyxDQUFDLENBQUM7U0FFN0M7UUFFRCxVQUFVLENBQUMsR0FBRyxDQUFDLFVBQVUsRUFBTyxJQUFJLENBQUMsQ0FBQztRQUV0QyxJQUFHLGtCQUFrQixFQUFDO1lBRXBCLElBQUksQ0FBQyxpQkFBUyxDQUFDLEdBQUcsVUFBVSxDQUFDO1lBQzdCLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDO1lBQ25CLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDO1NB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