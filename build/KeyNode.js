"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var _a;
"use strict";
exports.ROOT_KEYS = Symbol('Root Keys Lib');
const CHILDREN = Symbol('Child Keys Lib');
const DEPTH = Symbol('Depth Cache');
const PARENTS = Symbol('Parents Cache');
class BaseKeyNode extends String {
    constructor(key, parent) {
        super(key);
        this[_a] = new Map();
        const keyLiteral = this.toString();
        const parentIsRootKeyLib = parent instanceof Map;
        const siblingLib = parentIsRootKeyLib ? parent : parent[CHILDREN];
        if (siblingLib.has(keyLiteral)) {
            throw new Error(`'${keyLiteral}' already exists in sibling set.` +
                `  Sibling key literals must be unique.`);
        }
        siblingLib.set(keyLiteral, this);
        if (parentIsRootKeyLib) {
            this[exports.ROOT_KEYS] = siblingLib;
            this.PARENT = null;
            this.IS_ROOT_KEY = true;
        }
        else {
            this.PARENT = parent;
            this.IS_ROOT_KEY = false;
        }
    }
    //Accessors 
    get isTerminalKey() {
        return this[CHILDREN].size === 0;
    }
    get parent() {
        return this.PARENT;
    }
    get [(_a = CHILDREN, Symbol.toStringTag)]() {
        return this.constructor.name;
    }
    get numChildren() {
        return this[CHILDREN].size;
    }
    get depth() {
        //Get and cache depth; lazy
        if (this[DEPTH] === undefined) {
            let depth = 0;
            for (const pKey of this.parents()) {
                depth++;
            }
            this[DEPTH] = depth;
        }
        return this[DEPTH];
    }
    //Mehtods
    hasChild(childKey) {
        return this[CHILDREN].has(childKey);
    }
    getChild(childKey) {
        const children = this[CHILDREN];
        return children.has(childKey) ? children.get(childKey) : null;
    }
    hasSibling(siblingKey) {
        const sliblingKeyLib = this.IS_ROOT_KEY ? this[exports.ROOT_KEYS] : this.PARENT[CHILDREN];
        return sliblingKeyLib.has(siblingKey) ?
            sliblingKeyLib.get(siblingKey) !== this : false;
    }
    getSibling(siblingKey) {
        if (this.hasSibling(siblingKey)) {
            const sliblingKeyLib = this.IS_ROOT_KEY ? this[exports.ROOT_KEYS] : this.PARENT[CHILDREN];
            return sliblingKeyLib.get(siblingKey);
        }
        ;
        return null;
    }
    children() {
        //NOTE: Not cached b/c can increase.
        return this[CHILDREN].values();
    }
    parents() {
        //Get and cache parents; lazy
        if (this[PARENTS] === undefined) {
            let pKeys = new Set();
            let pKey = this.PARENT;
            while (pKey !== null) {
                pKeys.add(pKey);
                pKey = pKey.PARENT;
            }
            this[PARENTS] = pKeys;
        }
        return this[PARENTS].values();
    }
    *siblings() {
        //NOTE: Not cached b/c can increase.
        const siblingsIter = this.IS_ROOT_KEY ? this[exports.ROOT_KEYS].values() : this.PARENT.children();
        for (const sib of siblingsIter) {
            if (sib !== this) {
                yield sib;
            }
        }
    }
}
exports.BaseKeyNode = BaseKeyNode;
class KeyNode extends BaseKeyNode {
}
exports.KeyNode = KeyNode;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiS2V5Tm9kZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9LZXlOb2RlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBYSxRQUFBLFNBQVMsR0FBaUIsTUFBTSxDQUFDLGVBQWUsQ0FBQyxDQUFDO0FBQy9ELE1BQU0sUUFBUSxHQUFpQixNQUFNLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztBQUN4RCxNQUFNLEtBQUssR0FBaUIsTUFBTSxDQUFDLGFBQWEsQ0FBQyxDQUFDO0FBQ2xELE1BQU0sT0FBTyxHQUFpQixNQUFNLENBQUMsZUFBZSxDQUFDLENBQUM7QUFFdEQsaUJBQW1FLFNBQVEsTUFBTTtJQVUvRSxZQUFZLEdBQVUsRUFBRSxNQUFpQztRQUV2RCxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7UUFOSSxRQUFVLEdBQUcsSUFBSSxHQUFHLEVBQWdCLENBQUM7UUFRcEQsTUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQ25DLE1BQU0sa0JBQWtCLEdBQUcsTUFBTSxZQUFZLEdBQUcsQ0FBQztRQUNqRCxNQUFNLFVBQVUsR0FBcUIsa0JBQWtCLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBRXBGLElBQUcsVUFBVSxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsRUFBQztZQUU1QixNQUFNLElBQUksS0FBSyxDQUFDLElBQUksVUFBVSxrQ0FBa0M7Z0JBQzlELHdDQUF3QyxDQUFDLENBQUM7U0FFN0M7UUFFRCxVQUFVLENBQUMsR0FBRyxDQUFDLFVBQVUsRUFBTyxJQUFJLENBQUMsQ0FBQztRQUV0QyxJQUFHLGtCQUFrQixFQUFDO1lBRXBCLElBQUksQ0FBQyxpQkFBUyxDQUFDLEdBQUcsVUFBVSxDQUFDO1lBQzdCLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDO1lBQ25CLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDO1NBRXpCO2FBQU07WUFFTCxJQUFJLENBQUMsTUFBTSxHQUFVLE1BQU0sQ0FBQztZQUM1QixJQUFJLENBQUMsV0FBVyxHQUFHLEtBQUssQ0FBQztTQUUxQjtJQUVILENBQUM7SUFFRCxZQUFZO0lBQ1osSUFBSSxhQUFhO1FBRWYsT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsSUFBSSxLQUFLLENBQUMsQ0FBQztJQUVuQyxDQUFDO0lBRUQsSUFBSSxNQUFNO1FBRVIsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDO0lBRXJCLENBQUM7SUFFRCxJQUFJLE9BakRjLFFBQVEsRUFpRHJCLE1BQU0sQ0FBQyxXQUFXLEVBQUM7UUFFdEIsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQztJQUUvQixDQUFDO0lBR0QsSUFBSSxXQUFXO1FBRWIsT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsSUFBSSxDQUFDO0lBRTdCLENBQUM7SUFFRCxJQUFJLEtBQUs7UUFFUCwyQkFBMkI7UUFDM0IsSUFBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssU0FBUyxFQUFDO1lBRTNCLElBQUksS0FBSyxHQUFHLENBQUMsQ0FBQztZQUVkLEtBQUksTUFBTSxJQUFJLElBQUksSUFBSSxDQUFDLE9BQU8sRUFBRSxFQUFDO2dCQUUvQixLQUFLLEVBQUUsQ0FBQzthQUVUO1lBRUQsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLEtBQUssQ0FBQztTQUVyQjtRQUVELE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBRXJCLENBQUM7SUFHRCxTQUFTO0lBQ1QsUUFBUSxDQUFDLFFBQWU7UUFFdEIsT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBRXRDLENBQUM7SUFFRCxRQUFRLENBQUMsUUFBZTtRQUV0QixNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7UUFFaEMsT0FBTyxRQUFRLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7SUFFaEUsQ0FBQztJQUdELFVBQVUsQ0FBQyxVQUFpQjtRQUUxQixNQUFNLGNBQWMsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsaUJBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBRWxGLE9BQU8sY0FBYyxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDO1lBQ3JDLGNBQWMsQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLEtBQUssSUFBSSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUM7SUFFcEQsQ0FBQztJQUVELFVBQVUsQ0FBQyxVQUFpQjtRQUUxQixJQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsVUFBVSxDQUFDLEVBQUM7WUFFN0IsTUFBTSxjQUFjLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLGlCQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUVsRixPQUFPLGNBQWMsQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLENBQUM7U0FFdkM7UUFBQSxDQUFDO1FBRUYsT0FBTyxJQUFJLENBQUM7SUFFZCxDQUFDO0lBRUQsUUFBUTtRQUVOLG9DQUFvQztRQUNwQyxPQUFPLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQztJQUVqQyxDQUFDO0lBRUQsT0FBTztRQUVMLDZCQUE2QjtRQUM3QixJQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxTQUFTLEVBQUM7WUFFN0IsSUFBSSxLQUFLLEdBQUcsSUFBSSxHQUFHLEVBQVMsQ0FBQztZQUU3QixJQUFJLElBQUksR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDO1lBRXZCLE9BQU0sSUFBSSxLQUFLLElBQUksRUFBQztnQkFFbEIsS0FBSyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFFaEIsSUFBSSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUE7YUFFbkI7WUFFRCxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsS0FBSyxDQUFDO1NBRXZCO1FBRUQsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsTUFBTSxFQUFFLENBQUM7SUFFaEMsQ0FBQztJQUVELENBQUMsUUFBUTtRQUVQLG9DQUFvQztRQUNwQyxNQUFNLFlBQVksR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsaUJBQVMsQ0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBRTFGLEtBQUksTUFBTSxHQUFHLElBQUksWUFBWSxFQUFDO1lBRTVCLElBQUcsR0FBRyxLQUFLLElBQUksRUFBQztnQkFFZCxNQUFNLEdBQUcsQ0FBQzthQUVYO1NBRUY7SUFFSCxDQUFDO0NBRUY7QUFsTEQsa0NBa0xDO0FBRUQsYUFBcUIsU0FBUSxXQUFvQjtDQUFHO0FBQXBELDBCQUFvRCJ9