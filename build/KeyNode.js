"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var _a;
"use strict";
exports.ROOT_KEYS = Symbol('Root Keys Lib');
const CHILDREN = Symbol('Child Keys Lib');
const DEPTH = Symbol('Depth Cache');
const PARENTS = Symbol('Parents Cache');
class KeyNode extends String {
    constructor(key, parent) {
        super(key);
        this[_a] = new Map();
        const keyLiteral = this.toString();
        const parentIsRootKeyLib = parent instanceof Map;
        const siblingLib = parentIsRootKeyLib ? parent : parent[CHILDREN];
        if (siblingLib.has(keyLiteral)) {
            throw new Error(`'${keyLiteral}' already exists in sibling set.` +
                `  Sibling key literals must be unique.`);
        }
        siblingLib.set(keyLiteral, this);
        if (parentIsRootKeyLib) {
            this[exports.ROOT_KEYS] = siblingLib;
            this.PARENT = null;
            this.IS_ROOT_KEY = true;
        }
        else {
            this.PARENT = parent;
            this.IS_ROOT_KEY = false;
        }
    }
    //Accessors 
    get isTerminalKey() {
        return this[CHILDREN].size === 0;
    }
    get parent() {
        return this.PARENT;
    }
    get [(_a = CHILDREN, Symbol.toStringTag)]() {
        return this.constructor.name;
    }
    get numChildren() {
        return this[CHILDREN].size;
    }
    get depth() {
        //Get and cache depth; lazy
        if (this[DEPTH] === undefined) {
            let depth = 0;
            for (const pKey of this.parents()) {
                depth++;
            }
            this[DEPTH] = depth;
        }
        return this[DEPTH];
    }
    //Mehtods
    hasChild(childKey) {
        return this[CHILDREN].has(childKey);
    }
    getChild(childKey) {
        const children = this[CHILDREN];
        return children.has(childKey) ? children.get(childKey) : null;
    }
    hasSibling(siblingKey) {
        const sliblingKeyLib = this.IS_ROOT_KEY ? this[exports.ROOT_KEYS] : this.PARENT[CHILDREN];
        return sliblingKeyLib.has(siblingKey) ?
            sliblingKeyLib.get(siblingKey) !== this : false;
    }
    getSibling(siblingKey) {
        if (this.hasSibling(siblingKey)) {
            const sliblingKeyLib = this.IS_ROOT_KEY ? this[exports.ROOT_KEYS] : this.PARENT[CHILDREN];
            return sliblingKeyLib.get(siblingKey);
        }
        ;
        return null;
    }
    children() {
        //NOTE: Not cached b/c can increase.
        return this[CHILDREN].values();
    }
    parents() {
        //Get and cache parents; lazy
        if (this[PARENTS] === undefined) {
            let pKeys = new Set();
            let pKey = this.PARENT;
            while (pKey !== null) {
                pKeys.add(pKey);
                pKey = pKey.PARENT;
            }
            this[PARENTS] = pKeys;
        }
        return this[PARENTS].values();
    }
    *siblings() {
        //NOTE: Not cached b/c can increase.
        const siblingsIter = this.IS_ROOT_KEY ? this[exports.ROOT_KEYS].values() : this.PARENT.children();
        for (const sib of siblingsIter) {
            if (sib !== this) {
                yield sib;
            }
        }
    }
}
exports.default = KeyNode;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiS2V5Tm9kZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9LZXlOb2RlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBYSxRQUFBLFNBQVMsR0FBaUIsTUFBTSxDQUFDLGVBQWUsQ0FBQyxDQUFDO0FBQy9ELE1BQU0sUUFBUSxHQUFpQixNQUFNLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztBQUN4RCxNQUFNLEtBQUssR0FBaUIsTUFBTSxDQUFDLGFBQWEsQ0FBQyxDQUFDO0FBQ2xELE1BQU0sT0FBTyxHQUFpQixNQUFNLENBQUMsZUFBZSxDQUFDLENBQUM7QUFFdEQsYUFBbUUsU0FBUSxNQUFNO0lBVS9FLFlBQVksR0FBVSxFQUFFLE1BQWlDO1FBRXZELEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztRQU5JLFFBQVUsR0FBRyxJQUFJLEdBQUcsRUFBZ0IsQ0FBQztRQVFwRCxNQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDbkMsTUFBTSxrQkFBa0IsR0FBRyxNQUFNLFlBQVksR0FBRyxDQUFDO1FBQ2pELE1BQU0sVUFBVSxHQUFxQixrQkFBa0IsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUM7UUFFcEYsSUFBRyxVQUFVLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxFQUFDO1lBRTVCLE1BQU0sSUFBSSxLQUFLLENBQUMsSUFBSSxVQUFVLGtDQUFrQztnQkFDOUQsd0NBQXdDLENBQUMsQ0FBQztTQUU3QztRQUVELFVBQVUsQ0FBQyxHQUFHLENBQUMsVUFBVSxFQUFPLElBQUksQ0FBQyxDQUFDO1FBRXRDLElBQUcsa0JBQWtCLEVBQUM7WUFFcEIsSUFBSSxDQUFDLGlCQUFTLENBQUMsR0FBRyxVQUFVLENBQUM7WUFDN0IsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUM7WUFDbkIsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUM7U0FF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